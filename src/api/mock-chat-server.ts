/**
 * Mock Chat Server - é–‹ç™ºç”¨CoachAI APIã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
 */

export interface MockChatRequest {
  prompt: string;
  sessionState: {
    sessionAttributes: {
      session_id: string;
      jwt_token: string;
      timezone?: string;
      language?: string;
    };
  };
}

export interface MockChatResponse {
  content: string;
  sessionId: string;
  timestamp: string;
}

/**
 * ãƒ¢ãƒƒã‚¯å¿œç­”ãƒ‡ãƒ¼ã‚¿
 */
const MOCK_RESPONSES = [
  {
    triggers: ['ã“ã‚“ã«ã¡ã¯', 'ã¯ã˜ã‚ã¾ã—ã¦', 'ã‚ˆã‚ã—ã'],
    response: `ã“ã‚“ã«ã¡ã¯ï¼å¥åº·ã‚³ãƒ¼ãƒã®AIã§ã™ã€‚\n\nä»Šæ—¥ã¯ã©ã®ã‚ˆã†ãªå¥åº·ã«é–¢ã™ã‚‹ã”ç›¸è«‡ã§ã—ã‚‡ã†ã‹ï¼Ÿ\n\n**ç§ãŒãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ï¼š**\n- ğŸ **æ „é¤Šãƒ»é£Ÿäº‹ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹**\n- ğŸƒâ€â™‚ï¸ **é‹å‹•ãƒ»ãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ã®ææ¡ˆ**\n- ğŸ˜´ **ç¡çœ ã®è³ªå‘ä¸Šã®ãƒ’ãƒ³ãƒˆ**\n- ğŸ§˜â€â™€ï¸ **ã‚¹ãƒˆãƒ¬ã‚¹ç®¡ç†ã¨ãƒ¡ãƒ³ã‚¿ãƒ«ã‚±ã‚¢**\n- ğŸ“Š **å¥åº·ç›®æ¨™ã®è¨­å®šã¨ç®¡ç†**\n\nä½•ã§ã‚‚ãŠæ°—è»½ã«ãŠèããã ã•ã„ï¼`
  },
  {
    triggers: ['é‹å‹•', 'ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚º', 'ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°', 'ãƒ•ã‚£ãƒƒãƒˆãƒã‚¹'],
    response: `é‹å‹•ã«ã¤ã„ã¦ã®ã”è³ªå•ã§ã™ã­ï¼\n\n**åŠ¹æœçš„ãªé‹å‹•ã®ãƒã‚¤ãƒ³ãƒˆï¼š**\n\n## ğŸ¯ é‹å‹•ã®åŸºæœ¬åŸå‰‡\n\n1. **é »åº¦**: é€±3-5å›ã®å®šæœŸçš„ãªé‹å‹•\n2. **å¼·åº¦**: ä¸­ç¨‹åº¦ã®å¼·åº¦ï¼ˆä¼šè©±ãŒã§ãã‚‹ç¨‹åº¦ï¼‰\n3. **æ™‚é–“**: 1å›30-60åˆ†ç¨‹åº¦\n4. **ç¨®é¡**: æœ‰é…¸ç´ é‹å‹• + ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°\n\n## ğŸƒâ€â™‚ï¸ ãŠã™ã™ã‚ã®é‹å‹•\n\n### åˆå¿ƒè€…å‘ã‘\n- ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°ï¼ˆ1æ—¥8,000-10,000æ­©ï¼‰\n- è»½ã„ã‚¸ãƒ§ã‚®ãƒ³ã‚°\n- æ°´æ³³\n- ãƒ¨ã‚¬ãƒ»ã‚¹ãƒˆãƒ¬ãƒƒãƒ\n\n### ä¸­ç´šè€…å‘ã‘\n- ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°\n- ã‚µã‚¤ã‚¯ãƒªãƒ³ã‚°\n- ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°\n- ãƒ€ãƒ³ã‚¹ãƒ»ã‚¨ã‚¢ãƒ­ãƒ“ã‚¯ã‚¹\n\n**ä»Šã®é‹å‹•ç¿’æ…£ã«ã¤ã„ã¦æ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿã‚ˆã‚Šå…·ä½“çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ãŠä¼ãˆã—ã¾ã™ã€‚**`
  },
  {
    triggers: ['é£Ÿäº‹', 'æ „é¤Š', 'ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ', 'é£Ÿã¹ç‰©', 'æ–™ç†'],
    response: `æ „é¤Šãƒ»é£Ÿäº‹ã«ã¤ã„ã¦ã®ã”è³ªå•ã§ã™ã­ï¼\n\n**å¥åº·çš„ãªé£Ÿäº‹ã®åŸºæœ¬ï¼š**\n\n## ğŸ½ï¸ ãƒãƒ©ãƒ³ã‚¹ã®è‰¯ã„é£Ÿäº‹\n\n### ä¸»è¦æ „é¤Šç´ ã®å‰²åˆ\n- **ç‚­æ°´åŒ–ç‰©**: 50-65%ï¼ˆç„ç±³ã€å…¨ç²’ç²‰ãƒ‘ãƒ³ãªã©ï¼‰\n- **ã‚¿ãƒ³ãƒ‘ã‚¯è³ª**: 15-20%ï¼ˆé­šã€è‚‰ã€è±†é¡ã€åµãªã©ï¼‰\n- **è„‚è³ª**: 20-30%ï¼ˆã‚ªãƒªãƒ¼ãƒ–ã‚ªã‚¤ãƒ«ã€ãƒŠãƒƒãƒ„ãªã©ï¼‰\n\n### ğŸ¥— 1æ—¥ã®é£Ÿäº‹ä¾‹\n\n**æœé£Ÿ**\n- ç„ç±³ã”é£¯ + å‘³å™Œæ± + ç„¼ãé­š + é‡èœã‚µãƒ©ãƒ€\n\n**æ˜¼é£Ÿ**\n- å…¨ç²’ç²‰ãƒ‘ãƒ³ + ãƒã‚­ãƒ³ã‚µãƒ©ãƒ€ + é‡èœã‚¹ãƒ¼ãƒ—\n\n**å¤•é£Ÿ**\n- ç„ç±³ã”é£¯ + è±†è…ãƒãƒ³ãƒãƒ¼ã‚° + é‡èœç‚’ã‚ + æœç‰©\n\n## ğŸ’¡ å®Ÿè·µã®ã‚³ãƒ„\n\n1. **é‡èœã‚’å…ˆã«é£Ÿã¹ã‚‹**ï¼ˆè¡€ç³–å€¤ã®æ€¥ä¸Šæ˜‡ã‚’é˜²ãï¼‰\n2. **ã‚ˆãå™›ã‚“ã§é£Ÿã¹ã‚‹**ï¼ˆæº€è…¹æ„Ÿã‚’å¾—ã‚„ã™ã„ï¼‰\n3. **æ°´åˆ†ã‚’ã—ã£ã‹ã‚Šæ‘‚ã‚‹**ï¼ˆ1æ—¥1.5-2Lï¼‰\n4. **è¦å‰‡æ­£ã—ã„é£Ÿäº‹æ™‚é–“**\n\n**ç¾åœ¨ã®é£Ÿäº‹ç¿’æ…£ã§æ°—ã«ãªã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ**`
  },
  {
    triggers: ['ç¡çœ ', 'çœ ã‚Œãªã„', 'ä¸çœ ', 'å¯ä¸è¶³'],
    response: `ç¡çœ ã«ã¤ã„ã¦ã®ã”ç›¸è«‡ã§ã™ã­ï¼\n\n**è³ªã®è‰¯ã„ç¡çœ ã®ãŸã‚ã«ï¼š**\n\n## ğŸ˜´ ç†æƒ³çš„ãªç¡çœ \n\n- **ç¡çœ æ™‚é–“**: 7-9æ™‚é–“ï¼ˆå€‹äººå·®ã‚ã‚Šï¼‰\n- **å°±å¯æ™‚é–“**: æ¯æ—¥åŒã˜æ™‚é–“\n- **èµ·åºŠæ™‚é–“**: æ¯æ—¥åŒã˜æ™‚é–“\n\n## ğŸŒ™ ç¡çœ ã®è³ªã‚’å‘ä¸Šã•ã›ã‚‹æ–¹æ³•\n\n### å°±å¯å‰ã®ç¿’æ…£\n1. **2-3æ™‚é–“å‰**: å¤•é£Ÿã‚’æ¸ˆã¾ã›ã‚‹\n2. **1æ™‚é–“å‰**: ã‚¹ãƒãƒ›ãƒ»PCã®ä½¿ç”¨ã‚’æ§ãˆã‚‹\n3. **30åˆ†å‰**: ãƒªãƒ©ãƒƒã‚¯ã‚¹ã‚¿ã‚¤ãƒ ï¼ˆèª­æ›¸ã€ç‘æƒ³ãªã©ï¼‰\n\n### ç¡çœ ç’°å¢ƒã®æ•´å‚™\n- **å®¤æ¸©**: 18-22â„ƒ\n- **æ¹¿åº¦**: 50-60%\n- **ç…§æ˜**: æš—ãé™ã‹ãªç’°å¢ƒ\n- **å¯å…·**: å¿«é©ãªãƒãƒƒãƒˆãƒ¬ã‚¹ã¨æ•\n\n### ğŸš« é¿ã‘ã‚‹ã¹ãã“ã¨\n- å°±å¯å‰ã®ã‚«ãƒ•ã‚§ã‚¤ãƒ³æ‘‚å–\n- æ¿€ã—ã„é‹å‹•\n- å¤§é‡ã®æ°´åˆ†æ‘‚å–\n- ã‚¹ãƒˆãƒ¬ã‚¹ã®å¤šã„æ´»å‹•\n\n## â˜€ï¸ æœã®ç¿’æ…£\n- èµ·åºŠå¾Œã™ãã«æ—¥å…‰ã‚’æµ´ã³ã‚‹\n- è»½ã„é‹å‹•ã‚„ã‚¹ãƒˆãƒ¬ãƒƒãƒ\n- è¦å‰‡æ­£ã—ã„æœé£Ÿ\n\n**ç¾åœ¨ã®ç¡çœ ã§å›°ã£ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‚Œã°ã€è©³ã—ãæ•™ãˆã¦ãã ã•ã„ã€‚**`
  },
  {
    triggers: ['ã‚¹ãƒˆãƒ¬ã‚¹', 'ãƒ¡ãƒ³ã‚¿ãƒ«', 'ä¸å®‰', 'ç–²ã‚Œ'],
    response: `ã‚¹ãƒˆãƒ¬ã‚¹ç®¡ç†ã«ã¤ã„ã¦ã®ã”ç›¸è«‡ã§ã™ã­ï¼\n\n**å¿ƒã®å¥åº·ã‚‚ä½“ã®å¥åº·ã¨åŒã˜ãã‚‰ã„å¤§åˆ‡ã§ã™ã€‚**\n\n## ğŸ§˜â€â™€ï¸ ã‚¹ãƒˆãƒ¬ã‚¹è§£æ¶ˆæ³•\n\n### å³åŠ¹æ€§ã®ã‚ã‚‹æ–¹æ³•\n1. **æ·±å‘¼å¸**ï¼ˆ4ç§’å¸ã£ã¦ã€4ç§’æ­¢ã‚ã¦ã€8ç§’ã§åãï¼‰\n2. **è»½ã„é‹å‹•**ï¼ˆæ•£æ­©ã€ã‚¹ãƒˆãƒ¬ãƒƒãƒï¼‰\n3. **éŸ³æ¥½ã‚’è´ã**\n4. **æ¸©ã‹ã„ãŠé¢¨å‘‚**\n\n### é•·æœŸçš„ãªå¯¾ç­–\n1. **è¦å‰‡æ­£ã—ã„ç”Ÿæ´»ãƒªã‚ºãƒ **\n2. **é©åº¦ãªé‹å‹•ç¿’æ…£**\n3. **è¶£å‘³ã®æ™‚é–“ã‚’ä½œã‚‹**\n4. **äººã¨ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³**\n\n## ğŸŒ± ãƒã‚¤ãƒ³ãƒ‰ãƒ•ãƒ«ãƒã‚¹å®Ÿè·µ\n\n### ç°¡å˜ãªç‘æƒ³æ³•\n1. é™ã‹ãªå ´æ‰€ã«åº§ã‚‹\n2. ç›®ã‚’é–‰ã˜ã¦å‘¼å¸ã«é›†ä¸­\n3. 5-10åˆ†é–“ç¶šã‘ã‚‹\n4. é›‘å¿µãŒæµ®ã‹ã‚“ã§ã‚‚æ°—ã«ã—ãªã„\n\n### ğŸƒ è‡ªç„¶ã¨ã®è§¦ã‚Œåˆã„\n- å…¬åœ’ã§ã®æ•£æ­©\n- ã‚¬ãƒ¼ãƒ‡ãƒ‹ãƒ³ã‚°\n- æ£®æ—æµ´\n- æµ·ã‚„å·ã§ã®æ™‚é–“\n\n## âš ï¸ å°‚é–€å®¶ã¸ã®ç›¸è«‡\n\nä»¥ä¸‹ã®å ´åˆã¯åŒ»å¸«ã‚„ã‚«ã‚¦ãƒ³ã‚»ãƒ©ãƒ¼ã«ç›¸è«‡ã‚’ï¼š\n- 2é€±é–“ä»¥ä¸Šç¶šãå¼·ã„ä¸å®‰ã‚„è½ã¡è¾¼ã¿\n- ç¡çœ ã‚„é£Ÿäº‹ã«å¤§ããªå½±éŸ¿\n- æ—¥å¸¸ç”Ÿæ´»ã«æ”¯éšœã‚’ããŸã™\n\n**ä»Šæ„Ÿã˜ã¦ã„ã‚‹ã‚¹ãƒˆãƒ¬ã‚¹ã«ã¤ã„ã¦ã€ã‚‚ã†å°‘ã—è©³ã—ãæ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ**`
  }
];

/**
 * æ±ç”¨çš„ãªå¥åº·ã‚¢ãƒ‰ãƒã‚¤ã‚¹å¿œç­”
 */
const GENERIC_RESPONSES = [
  `ã”è³ªå•ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼\n\nå¥åº·ã«é–¢ã™ã‚‹ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚\n\n> ã€Œå¥åº·ã¯ä¸€æ—¥ã«ã—ã¦æˆã‚‰ãšã€\n\næ—¥ã€…ã®å°ã•ãªç©ã¿é‡ã­ãŒå¤§åˆ‡ã§ã™ã€‚\n\n**ä»Šæ—¥ã‹ã‚‰ã§ãã‚‹ã“ã¨ï¼š**\n- ğŸ’§ æ°´åˆ†è£œçµ¦ã‚’æ„è­˜ã™ã‚‹ï¼ˆ1æ—¥1.5-2Lï¼‰\n- ğŸš¶â€â™€ï¸ éšæ®µã‚’ä½¿ã†æ©Ÿä¼šã‚’å¢—ã‚„ã™\n- ğŸ« æ·±å‘¼å¸ã‚’5åˆ†é–“è¡Œã†\n- ğŸ¥— é‡èœã‚’ä¸€å“è¿½åŠ ã™ã‚‹\n\n\`\`\`\nå¥åº·ã‚¹ã‚³ã‚¢ = é‹å‹• + æ „é¤Š + ç¡çœ  + ãƒ¡ãƒ³ã‚¿ãƒ«ã‚±ã‚¢\n\`\`\`\n\nä»–ã«ã‚‚æ°—ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Œã°ã€ä½•ã§ã‚‚ãŠèããã ã•ã„ï¼`,

  `å¥åº·ç®¡ç†ã«ãŠã„ã¦é‡è¦ãªã®ã¯ã€**ç¶™ç¶šæ€§**ã¨**ãƒãƒ©ãƒ³ã‚¹**ã§ã™ã€‚\n\n## ğŸ¯ å¥åº·ã®4ã¤ã®æŸ±\n\n### 1. ğŸƒâ€â™‚ï¸ é‹å‹•\n- é€±3å›ã€30åˆ†ç¨‹åº¦ã®æœ‰é…¸ç´ é‹å‹•\n- ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚‚çµ„ã¿åˆã‚ã›ã‚‹\n- æ—¥å¸¸ç”Ÿæ´»ã§ã®æ´»å‹•é‡ã‚’å¢—ã‚„ã™\n\n### 2. ğŸ æ „é¤Š\n- ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸé£Ÿäº‹\n- é‡èœãƒ»æœç‰©ã‚’å¤šãæ‘‚å–\n- é©åˆ‡ãªæ°´åˆ†è£œçµ¦\n\n### 3. ğŸ˜´ ç¡çœ \n- 7-9æ™‚é–“ã®è³ªã®è‰¯ã„ç¡çœ \n- è¦å‰‡æ­£ã—ã„ç¡çœ ãƒªã‚ºãƒ \n- ãƒªãƒ©ãƒƒã‚¯ã‚¹ã§ãã‚‹ç¡çœ ç’°å¢ƒ\n\n### 4. ğŸ§˜â€â™€ï¸ ãƒ¡ãƒ³ã‚¿ãƒ«ã‚±ã‚¢\n- ã‚¹ãƒˆãƒ¬ã‚¹ç®¡ç†\n- ãƒªãƒ©ã‚¯ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³\n- ç¤¾ä¼šçš„ãªã¤ãªãŒã‚Š\n\n**ã©ã®åˆ†é‡ã«ã¤ã„ã¦è©³ã—ãçŸ¥ã‚ŠãŸã„ã§ã™ã‹ï¼Ÿ**`,

  `å€‹äººã«åˆã‚ã›ãŸå¥åº·ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ãŠä¼ãˆã—ã¾ã™ã€‚\n\n**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆï¼š**\n\n## â­ å€‹äººå·®ã‚’è€ƒæ…®ã™ã‚‹\n- å¹´é½¢ã€æ€§åˆ¥ã€ä½“è³ªã«ã‚ˆã‚Šæœ€é©è§£ã¯ç•°ãªã‚Šã¾ã™\n- ç¾åœ¨ã®å¥åº·çŠ¶æ…‹ã‚’æŠŠæ¡ã™ã‚‹ã“ã¨ãŒå¤§åˆ‡\n- ç„¡ç†ã®ãªã„ç¯„å›²ã§å§‹ã‚ã‚‹ã“ã¨ãŒé‡è¦\n\n## ğŸ¯ ç›®æ¨™è¨­å®šã®ã‚³ãƒ„\n- **SMARTåŸå‰‡**ã‚’æ´»ç”¨\n  - **S**pecificï¼ˆå…·ä½“çš„ï¼‰\n  - **M**easurableï¼ˆæ¸¬å®šå¯èƒ½ï¼‰\n  - **A**chievableï¼ˆé”æˆå¯èƒ½ï¼‰\n  - **R**elevantï¼ˆé–¢é€£æ€§ï¼‰\n  - **T**ime-boundï¼ˆæœŸé™è¨­å®šï¼‰\n\n## ğŸ“Š è¨˜éŒ²ã‚’ã¤ã‘ã‚‹\n- ä½“é‡ã€é£Ÿäº‹ã€é‹å‹•ã®è¨˜éŒ²\n- å¤‰åŒ–ã‚’å¯è¦–åŒ–ã™ã‚‹ã“ã¨ã§ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ç¶­æŒ\n- ã‚¢ãƒ—ãƒªã‚„ãƒãƒ¼ãƒˆã‚’æ´»ç”¨\n\n**ç¾åœ¨ã®ç”Ÿæ´»ç¿’æ…£ã«ã¤ã„ã¦è©³ã—ãæ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿã‚ˆã‚Šå…·ä½“çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ãŒã§ãã¾ã™ã€‚**`
];

/**
 * ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«åŸºã¥ã„ã¦é©åˆ‡ãªå¿œç­”ã‚’é¸æŠ
 */
function selectResponse(prompt: string): string {
  const lowerPrompt = prompt.toLowerCase();
  
  // ç‰¹å®šã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã«åŸºã¥ãå¿œç­”ã‚’æ¤œç´¢
  for (const mockResponse of MOCK_RESPONSES) {
    if (mockResponse.triggers.some(trigger => lowerPrompt.includes(trigger))) {
      return mockResponse.response;
    }
  }
  
  // æ±ç”¨çš„ãªå¿œç­”ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠ
  const randomIndex = Math.floor(Math.random() * GENERIC_RESPONSES.length);
  return GENERIC_RESPONSES[randomIndex];
}

/**
 * ãƒ¢ãƒƒã‚¯ãƒãƒ£ãƒƒãƒˆAPI
 */
export async function mockChatAPI(request: MockChatRequest): Promise<MockChatResponse> {
  // ãƒªã‚¢ãƒ«ãªAPIé…å»¶ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
  const delay = 1000 + Math.random() * 2000; // 1-3ç§’
  
  await new Promise(resolve => setTimeout(resolve, delay));
  
  // 10%ã®ç¢ºç‡ã§ã‚¨ãƒ©ãƒ¼ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆï¼ˆé–‹ç™ºç”¨ï¼‰
  if (Math.random() < 0.1) {
    throw new Error('Mock API Error: ã‚µãƒ¼ãƒ“ã‚¹ãŒä¸€æ™‚çš„ã«åˆ©ç”¨ã§ãã¾ã›ã‚“');
  }
  
  const response = selectResponse(request.prompt);
  
  return {
    content: response,
    sessionId: request.sessionState.sessionAttributes.session_id,
    timestamp: new Date().toISOString(),
  };
}

/**
 * ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¿œç­”ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
 */
export async function* mockStreamingChatAPI(
  request: MockChatRequest
): AsyncGenerator<string, void, unknown> {
  const response = selectResponse(request.prompt);
  const words = response.split(' ');
  
  // å˜èªã”ã¨ã«ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°
  for (let i = 0; i < words.length; i++) {
    const chunk = i === 0 ? words[i] : ' ' + words[i];
    yield chunk;
    
    // ãƒ©ãƒ³ãƒ€ãƒ ãªé…å»¶ï¼ˆ50-200msï¼‰
    const delay = 50 + Math.random() * 150;
    await new Promise(resolve => setTimeout(resolve, delay));
  }
}
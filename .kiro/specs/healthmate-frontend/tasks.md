# 実装計画: Healthmate-Frontend

## 概要

React + Vite + TypeScript技術スタックを使用したモダンなSPAフロントエンドの実装。Vercel AI SDKを活用したストリーミングチャット機能と、Cognito認証の統合を段階的に実装します。

## タスク

- [x] 0. 開発環境セットアップ
  - Node.js 環境の確認（推奨: Node.js 18以上）
  - npm または yarn パッケージマネージャーの確認
  - 開発用ディレクトリの作成
  - _要件: 要件6.1_

- [x] 1. プロジェクト基盤セットアップ
  - Vite + React + TypeScript プロジェクトの初期化
  - 必要な依存関係のインストール（Tailwind CSS、shadcn/ui、Vercel AI SDK等）
  - 基本的なプロジェクト構造の作成
  - _要件: 要件6.3, 要件6.4_

- [x] 2. 認証システムの実装
  - [x] 2.1 AuthSession データモデルとAuthSessionManager の実装
    - AuthSession インターフェースの定義
    - AuthSessionManager クラスの実装（JWT/Refresh Token管理）
    - sessionStorage との連携機能
    - _要件: 要件1.2, 要件9.1, 要件9.2_

  - [ ]* 2.2 AuthSession管理のプロパティテスト作成
    - **プロパティ3: 認証セッション管理**
    - **検証対象: 要件 9.1, 9.2, 9.3**

  - [x] 2.3 AuthProvider コンポーネントの実装
    - React Context による認証状態管理
    - JWT Token の自動リフレッシュ機能
    - Cognito SDK との統合
    - _要件: 要件1.1, 要件1.3, 要件9.3_

  - [ ]* 2.4 認証システムの単体テスト作成
    - AuthProvider の動作テスト
    - トークンリフレッシュのテスト
    - エラーハンドリングのテスト
    - _要件: 要件1.3, 要件8.3_

- [x] 3. チェックポイント - 認証システム動作確認
  - すべてのテストが通ることを確認し、ユーザーに質問があれば確認する

- [x] 4. チャットセッション管理システムの実装
  - [x] 4.1 ChatSession データモデルとChatSessionManager の実装
    - ChatSession、Message インターフェースの定義
    - ChatSessionManager クラスの実装（33文字以上のID生成）
    - localStorage との連携機能
    - _要件: 要件3.1, 要件4.2_

  - [ ]* 4.2 ChatSession管理のプロパティテスト作成
    - **プロパティ2: チャットセッション継続性**
    - **検証対象: 要件 3.1, 3.2, 3.3**

  - [ ]* 4.3 セッションID一意性のプロパティテスト作成
    - **プロパティ8: チャットセッション作成の一意性**
    - **検証対象: 要件 4.2, 4.3**

  - [x] 4.4 ChatProvider コンポーネントの実装
    - React Context によるチャットセッション状態管理
    - セッション切り替え機能
    - Chat_History の永続化機能
    - _要件: 要件3.2, 要件3.3, 要件4.3_

  - [ ]* 4.5 チャットセッション管理の単体テスト作成
    - ChatProvider の動作テスト
    - セッション切り替えのテスト
    - データ永続化のテスト
    - _要件: 要件3.4, 要件4.4_

- [ ] 5. チャットUI コンポーネントの実装
  - [x] 5.1 MessageBubble コンポーネントの実装
    - User_Message と AI_Message の表示分岐
    - Markdown レンダリング機能（AI_Message用）
    - レスポンシブデザインの適用
    - _要件: 要件2.3, 要件5.1, 要件5.2_

  - [ ]* 5.2 Markdown レンダリング安全性のプロパティテスト作成
    - **プロパティ5: Markdown レンダリングの安全性**
    - **検証対象: 要件 2.3**

  - [x] 5.3 MessageList コンポーネントの実装
    - Chat_History の表示機能
    - スクロール管理とパフォーマンス最適化
    - 仮想化による大量メッセージ対応
    - _要件: 要件3.3, 要件6.1_

  - [x] 5.4 MessageInput コンポーネントの実装
    - メッセージ入力フォーム
    - 送信状態の表示
    - キーボードショートカット対応
    - _要件: 要件2.1, 要件7.3_

  - [ ]* 5.5 チャットUI コンポーネントの単体テスト作成
    - MessageBubble の表示テスト
    - MessageList のスクロールテスト
    - MessageInput の入力テスト
    - _要件: 要件2.3, 要件5.2_

- [x] 6. Vercel AI SDK統合とストリーミング機能
  - [x] 6.1 ChatInterface コンポーネントの実装
    - Vercel AI SDK の useChat フック統合
    - CoachAI API との連携設定
    - JWT Token を含むヘッダー設定
    - _要件: 要件2.1, 要件1.2_

  - [ ]* 6.2 ストリーミング応答完全性のプロパティテスト作成
    - **プロパティ4: ストリーミング応答の完全性**
    - **検証対象: 要件 2.1, 2.2**

  - [x] 6.3 API プロキシ設定とエラーハンドリング
    - Vite プロキシ設定の実装
    - ネットワークエラーハンドリング
    - CoachAI サービス停止時の対応
    - _要件: 要件8.1, 要件8.2_

  - [ ]* 6.4 ストリーミング機能の統合テスト作成
    - API 連携のテスト
    - エラーハンドリングのテスト
    - ストリーミング中断時の動作テスト
    - _要件: 要件2.2, 要件8.4_

- [ ] 7. チェックポイント - コア機能動作確認
  - すべてのテストが通ることを確認し、ユーザーに質問があれば確認する

- [ ] 8. 新規チャット機能とセッション切り替え
  - [ ] 8.1 新規チャットボタンコンポーネントの実装
    - 新しいChat_Session作成機能
    - 現在のセッション終了処理
    - UI フィードバック機能
    - _要件: 要件4.1, 要件4.2, 要件4.3_

  - [ ] 8.2 チャットセッション一覧コンポーネントの実装
    - 過去のChat_Session表示
    - セッション切り替え機能
    - セッション削除機能
    - _要件: 要件4.4_

  - [ ]* 8.3 セッション切り替え機能の単体テスト作成
    - 新規セッション作成のテスト
    - セッション切り替えのテスト
    - セッション削除のテスト
    - _要件: 要件4.2, 要件4.3, 要件4.4_

- [ ] 9. レスポンシブデザインとアクセシビリティ
  - [ ] 9.1 レスポンシブレイアウトの実装
    - モバイルファーストデザインの適用
    - ブレークポイント対応
    - タッチ操作最適化
    - _要件: 要件5.1, 要件5.2, 要件5.3_

  - [ ]* 9.2 レスポンシブレイアウト一貫性のプロパティテスト作成
    - **プロパティ6: レスポンシブレイアウトの一貫性**
    - **検証対象: 要件 5.1, 5.2**

  - [ ] 9.3 アクセシビリティ機能の実装
    - ARIA ラベルとセマンティック HTML
    - キーボードナビゲーション
    - スクリーンリーダー対応
    - _要件: 要件7.1, 要件7.2, 要件7.3_

  - [ ]* 9.4 アクセシビリティ準拠性のプロパティテスト作成
    - **プロパティ9: アクセシビリティの準拠性**
    - **検証対象: 要件 7.1, 7.2, 7.3**

- [ ] 10. エラーハンドリングとパフォーマンス最適化
  - [ ] 10.1 エラー境界コンポーネントの実装
    - React Error Boundary の実装
    - エラーフォールバック UI
    - エラー報告機能
    - _要件: 要件8.4_

  - [ ]* 10.2 エラー回復堅牢性のプロパティテスト作成
    - **プロパティ7: エラー回復の堅牢性**
    - **検証対象: 要件 8.1, 8.2, 8.4**

  - [ ] 10.3 パフォーマンス最適化の実装
    - コード分割とレイジーローディング
    - React.memo とuseMemo による最適化
    - バンドルサイズ最適化
    - _要件: 要件6.1, 要件6.2, 要件6.3_

  - [ ]* 10.4 パフォーマンス最適化の単体テスト作成
    - 初期読み込み時間のテスト
    - メモリ使用量のテスト
    - レンダリング最適化のテスト
    - _要件: 要件6.1, 要件6.2_

- [ ] 11. 統合とワイヤリング
  - [ ] 11.1 ルーティングシステムの実装
    - React Router の設定
    - ProtectedRoute コンポーネント
    - 認証フロー統合
    - _要件: 要件1.1, 要件1.4_

  - [ ] 11.2 全コンポーネントの統合
    - App コンポーネントでの全体統合
    - Provider の階層構造設定
    - グローバル状態管理の最終調整
    - _要件: 要件1.1, 要件2.1, 要件3.1_

  - [ ]* 11.3 E2E統合テスト作成
    - ユーザーログインフローのテスト
    - チャット機能の完全なフローテスト
    - セッション切り替えのE2Eテスト
    - _要件: 要件1.1, 要件2.1, 要件3.1, 要件4.1_

- [ ] 12. 最終チェックポイント - 全機能動作確認
  - すべてのテストが通ることを確認し、ユーザーに質問があれば確認する

## 注意事項

- `*` マークの付いたタスクはオプションで、より迅速なMVP開発のためにスキップ可能です
- 各タスクは前のタスクの完了を前提として構築されています
- チェックポイントでは段階的な検証を行い、問題があれば早期に対処します
- プロパティテストは fast-check ライブラリを使用し、最低100回の反復で実行します
- 単体テストは React Testing Library と Jest を使用します
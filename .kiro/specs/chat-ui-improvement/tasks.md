# 実装計画: チャットUI改良

## 概要

Healthmate-Frontend の /dashboard 画面のチャット機能において、ChatGPTのようなユーザーエクスペリエンスを実現するためのUI改良を実装します。既存のReact + TypeScript + Tailwind CSS技術スタックを活用し、動的レイアウトシステムによる中央配置から下部固定への遷移機能を追加します。

## タスク

- [x] 1. ChatLayoutManagerコンポーネントの実装
  - レイアウト状態管理（空チャット状態 ↔ アクティブチャット状態）の実装
  - 遷移アニメーション制御の実装
  - 子コンポーネントへの状態提供機能の実装
  - _要件: 1.1, 1.4, 2.1, 4.1, 4.2_

- [ ]* 1.1 ChatLayoutManagerの単体テストを作成
  - レイアウト状態遷移のテスト
  - アニメーション制御のテスト
  - _要件: 1.1, 2.1, 4.1_

- [x] 2. MessageInputコンポーネントの位置制御対応
  - 中央配置と下部固定の切り替え機能を追加
  - レイアウトモードに応じたスタイル適用
  - アニメーション遷移のサポート
  - _要件: 1.1, 1.3, 2.2, 4.1, 4.2_

- [ ]* 2.1 MessageInputの位置制御テストを作成
  - 中央配置モードのテスト
  - 下部固定モードのテスト
  - 遷移アニメーションのテスト
  - _要件: 1.1, 2.2, 4.1_

- [x] 3. MessageListコンポーネントのスクロール制御改良
  - ユーザーメッセージ送信時の上部表示スクロール機能を実装
  - AIレスポンス時の非オートスクロール機能を実装
  - スクロール位置の状態管理を追加
  - _要件: 6.1, 6.2, 6.3, 7.1, 7.2, 7.3_

- [ ]* 3.1 MessageListのスクロール制御テストを作成
  - **プロパティ2: メッセージ追加時の動作一貫性**
  - **検証対象: 要件 2.4, 6.4**

- [x] 4. ScrollToBottomButtonコンポーネントの実装
  - 最下部スクロールボタンの作成
  - スクロール位置に応じた表示/非表示制御
  - スムーズなスクロールアニメーション
  - _要件: 8.1, 8.2, 8.3, 8.4, 8.5_

- [ ]* 4.1 ScrollToBottomButtonの単体テストを作成
  - ボタン表示制御のテスト
  - スクロール動作のテスト
  - _要件: 8.1, 8.2, 8.3_

- [x] 5. ChatInterfaceコンポーネントの統合
  - ChatLayoutManagerを統合してレイアウト制御を追加
  - 既存の機能を維持しながら新しいレイアウトシステムを適用
  - メッセージ有無の判定ロジックを実装
  - _要件: 9.1, 9.2, 9.3, 9.4_

- [ ]* 5.1 ChatInterface統合テストを作成
  - **プロパティ3: 既存機能の後方互換性**
  - **検証対象: 要件 9.1, 9.2, 9.3, 9.4**

- [x] 6. チェックポイント - 基本機能の動作確認
  - 全てのテストが通ることを確認し、ユーザーに質問があれば尋ねる

- [x] 7. レスポンシブデザイン対応の実装
  - モバイルデバイス対応のスタイル調整
  - 画面サイズに応じたレイアウト適応
  - キーボード表示時の位置調整
  - _要件: 5.1, 5.2, 5.3, 5.4_

- [ ]* 7.1 レスポンシブデザインのテストを作成
  - **プロパティ1: レスポンシブレイアウトの一貫性**
  - **検証対象: 要件 1.4, 3.2, 3.3, 3.4, 5.1, 5.4**

- [x] 8. チャット表示エリアの中央寄せ実装
  - コンテンツコンテナの最大幅制御
  - 水平方向中央寄せのスタイル適用
  - 異なる画面サイズでの一貫したパディング・マージン
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [ ]* 8.1 チャット表示エリアの中央寄せテストを作成
  - 中央寄せレイアウトのテスト
  - 最大幅制御のテスト
  - _要件: 3.1, 3.2, 3.3_

- [x] 9. アニメーション最適化とアクセシビリティ対応
  - モーション軽減設定への対応
  - アニメーション時間の最適化
  - キーボードナビゲーション対応
  - _要件: 4.3, 4.4_

- [ ]* 9.1 アクセシビリティテストを作成
  - モーション軽減設定のテスト
  - キーボードナビゲーションのテスト
  - _要件: 4.4_

- [x] 10. 最終チェックポイント - 全機能の統合テスト
  - 全てのテストが通ることを確認し、ユーザーに質問があれば尋ねる

## 注意事項

- `*` マークの付いたタスクはオプションで、コア機能の実装を優先してMVPを早く完成させることができます
- 各タスクは既存のコンポーネントを段階的に改良する形で実装し、破壊的変更を避けます
- プロパティベーステストは、fast-checkライブラリを使用して実装します
- チェックポイントでは、実装の進捗を確認し、必要に応じてユーザーからのフィードバックを求めます
- 既存の認証、セッション管理、メッセージ送信機能は変更せず、UIレイアウトのみを改良します
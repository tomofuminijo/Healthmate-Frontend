# 要件文書

## 概要

Healthmate-Frontend の /dashboard 画面のチャット機能において、ChatGPTのようなユーザーエクスペリエンスを実現するためのUI改良を行います。新規チャット開始時は入力欄を画面中央に配置し、チャット開始後は入力欄を画面下部に固定する動的レイアウトを実装します。

## 用語集

- **チャット入力エリア**: チャットメッセージを入力するためのテキストエリアとボタンを含む領域
- **チャット表示エリア**: チャット履歴を表示する領域
- **空チャット状態**: メッセージが存在しない新規チャットの状態
- **アクティブチャット状態**: 1つ以上のメッセージが存在するチャットの状態
- **中央レイアウト**: 画面の垂直方向中央にコンテンツを配置するレイアウト
- **下部固定レイアウト**: 画面下部に固定されたレイアウト
- **コンテンツコンテナ**: チャット表示エリアの最大幅を制御するコンテナ

## 要件

### 要件1: 新規チャット時の中央配置レイアウト

**ユーザーストーリー:** ユーザーとして、新しいチャットを開始する際にチャット入力欄が画面中央に配置されることで、ChatGPTのようなクリーンで集中できるインターフェースを利用したい。

#### 受け入れ基準

1. ユーザーがメッセージのない新しいチャットセッションを開いた時、チャット入力エリアは画面の垂直方向中央に配置される
2. 空チャット状態がアクティブな時、チャット表示エリアは非表示または最小限の表示となる
3. 空チャット状態がアクティブな時、チャット入力エリアは最大限の視覚的な重要性を持つ
4. 空チャット状態で画面サイズが変更された時、チャット入力エリアは垂直方向の中央を維持する

### 要件2: チャット開始後の下部固定レイアウト

**ユーザーストーリー:** ユーザーとして、最初のメッセージを送信した後にチャット入力欄が画面下部に移動することで、会話履歴を見ながらチャットを続けることができるようにしたい。

#### 受け入れ基準

1. ユーザーが最初のメッセージを送信した時、チャット入力エリアは中央から下部の位置に遷移する
2. アクティブチャット状態がアクティブな時、チャット入力エリアは画面下部に固定される
3. アクティブチャット状態がアクティブな時、チャット表示エリアは入力エリアの上の残りの画面スペースを占有する
4. アクティブチャット状態で新しいメッセージが追加された時、チャット入力エリアは下部の位置を維持する

### 要件3: チャット表示エリアの中央寄せ

**ユーザーストーリー:** ユーザーとして、チャットメッセージが適切な幅で中央寄せされたコンテナに表示されることで、ChatGPTのように読みやすく視覚的に魅力的な会話を楽しみたい。

#### 受け入れ基準

1. メッセージが表示される時、チャット表示エリアは画面上で水平方向に中央寄せされる
2. 画面幅が大きい時、コンテンツコンテナは最適な読みやすさのために最大幅を持つ
3. 画面幅が小さい時、コンテンツコンテナは利用可能なスペースにレスポンシブに適応する
4. コンテンツコンテナは異なる画面サイズ間で一貫したパディングとマージンを維持する

### 要件4: スムーズなレイアウト遷移

**ユーザーストーリー:** ユーザーとして、中央レイアウトと下部レイアウト間のスムーズな遷移により、洗練されたプロフェッショナルなインターフェースを体験したい。

#### 受け入れ基準

1. 空チャット状態からアクティブチャット状態に遷移する時、チャット入力エリアは新しい位置にスムーズにアニメーションする
2. レイアウトが変更される時、遷移は300ms以内に完了する
3. アニメーションが進行中の時、ユーザー入力は機能し続ける
4. ユーザーがモーション軽減を好む時、遷移は最小限またはディスエーブルされる

### 要件5: レスポンシブデザイン対応

**ユーザーストーリー:** ユーザーとして、デスクトップとモバイルデバイスの両方でチャットインターフェースが適切に動作することで、異なるプラットフォーム間でシームレスに利用したい。

#### 受け入れ基準

1. モバイルデバイスを使用する時、チャット入力エリアは中央/下部の動作を維持しながら小さな画面サイズに適応する
2. モバイルでキーボードが表示される時、チャット入力エリアは適切に位置を調整する
3. 画面の向きが変更される時、レイアウトはスムーズに適応する
4. インターフェースは320pxから1920px幅の画面サイズ間で使いやすさを維持する

### 要件6: チャット送信時のスクロール動作

**ユーザーストーリー:** ユーザーとして、送信したメッセージがチャット表示エリアの上部にすぐに表示されることで、送信した内容を確認し会話の流れを追うことができるようにしたい。

#### 受け入れ基準

1. ユーザーがメッセージを送信した時、システムはユーザーメッセージをチャット表示エリアにすぐに表示する
2. ユーザーメッセージが追加された時、システムはユーザーメッセージが表示エリアの上部に見えるようにチャット表示エリアをスクロールする
3. ユーザーメッセージが表示される時、システムはスクロールをスムーズに200ms以内で完了する
4. 複数のメッセージが素早く送信された時、システムは各メッセージを適切に処理してスクロールする

### 要件7: AIレスポンス時の非オートスクロール

**ユーザーストーリー:** ユーザーとして、AIが応答している間に以前のメッセージを読むことができるよう、最下部への強制スクロールなしに会話を確認したい。

#### 受け入れ基準

1. AIレスポンスのチャンクが到着した時、システムはチャット表示エリアを自動的にスクロールしない
2. AIが応答している時、システムはユーザーが会話を手動でスクロールできるようにする
3. AIレスポンスがストリーミング中の時、システムはユーザーが手動で変更しない限りスクロール位置を安定させる
4. AIレスポンスが完了した時、システムはスクロール位置をユーザーが残した場所に維持する

### 要件8: チャット最下部移動ボタン

**ユーザーストーリー:** ユーザーとして、チャットの最下部に素早くスクロールするボタンにより、必要な時に最新のメッセージを簡単に見ることができるようにしたい。

#### 受け入れ基準

1. チャットにメッセージがある時、システムは最下部スクロールボタンをチャット入力エリアの上に表示する
2. ユーザーが最下部スクロールボタンをクリックした時、システムはチャット表示エリアを最下部にスムーズにスクロールする
3. ユーザーが既にチャットの最下部にいる時、システムは最下部スクロールボタンを非表示または無効化する
4. システムは最下部スクロールボタンに下向き矢印アイコン（↓）を表示する
5. 最下部スクロールアニメーションが完了する時、システムはアニメーションを300ms以内で完了する

### 要件9: 既存機能の保持

**ユーザーストーリー:** ユーザーとして、UI改良後も既存のチャット機能がすべて継続して動作することで、既に使用している機能を失わないようにしたい。

#### 受け入れ基準

1. UIが改良された時、システムは既存のメッセージ送信機能を変更なく継続して動作させる
2. UIが改良された時、システムは既存のメッセージ表示機能を変更なく継続して動作させる
3. UIが改良された時、システムは既存のセッション管理機能を変更なく継続して動作させる
4. UIが改良された時、システムは既存の認証統合機能を変更なく継続して動作させる